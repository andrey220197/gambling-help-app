"""
База тестов уровней C и D.

Уровень C — Еженедельные тесты (раз в неделю)
Уровень D — Событийные тесты (после срыва, при кризисе)
"""

# =========================================
# УРОВЕНЬ C — ЕЖЕНЕДЕЛЬНЫЕ ТЕСТЫ
# =========================================

LEVEL_C_TESTS = {
    # PGSI полный (раз в 2 недели для gambling)
    "C1": {
        "code": "C1",
        "level": "C",
        "name_ru": "PGSI — Полная оценка",
        "description_ru": "Еженедельная оценка игрового поведения (9 вопросов)",
        "track": "gambling",
        "frequency": "biweekly",  # раз в 2 недели
        "cooldown_days": 14,
        "questions": [
            {
                "code": "C1_Q1",
                "question_ru": "Ставили ли вы больше, чем можете себе позволить потерять?",
                "answer_type": "scale_0_3",
                "scale_labels": ["Никогда", "Иногда", "Часто", "Почти всегда"],
            },
            {
                "code": "C1_Q2",
                "question_ru": "Нужно ли вам было играть на большие суммы, чтобы получить то же возбуждение?",
                "answer_type": "scale_0_3",
                "scale_labels": ["Никогда", "Иногда", "Часто", "Почти всегда"],
            },
            {
                "code": "C1_Q3",
                "question_ru": "Возвращались ли вы, чтобы отыграть проигранное?",
                "answer_type": "scale_0_3",
                "scale_labels": ["Никогда", "Иногда", "Часто", "Почти всегда"],
            },
            {
                "code": "C1_Q4",
                "question_ru": "Занимали ли деньги или продавали вещи, чтобы играть?",
                "answer_type": "scale_0_3",
                "scale_labels": ["Никогда", "Иногда", "Часто", "Почти всегда"],
            },
            {
                "code": "C1_Q5",
                "question_ru": "Чувствовали ли, что у вас может быть проблема с игрой?",
                "answer_type": "scale_0_3",
                "scale_labels": ["Никогда", "Иногда", "Часто", "Почти всегда"],
            },
            {
                "code": "C1_Q6",
                "question_ru": "Вызывала ли игра у вас проблемы со здоровьем, включая стресс или тревогу?",
                "answer_type": "scale_0_3",
                "scale_labels": ["Никогда", "Иногда", "Часто", "Почти всегда"],
            },
            {
                "code": "C1_Q7",
                "question_ru": "Критиковали ли люди ваше увлечение игрой?",
                "answer_type": "scale_0_3",
                "scale_labels": ["Никогда", "Иногда", "Часто", "Почти всегда"],
            },
            {
                "code": "C1_Q8",
                "question_ru": "Вызывала ли игра финансовые проблемы для вас или вашей семьи?",
                "answer_type": "scale_0_3",
                "scale_labels": ["Никогда", "Иногда", "Часто", "Почти всегда"],
            },
            {
                "code": "C1_Q9",
                "question_ru": "Чувствовали ли вы вину за то, как играете или что происходит во время игры?",
                "answer_type": "scale_0_3",
                "scale_labels": ["Никогда", "Иногда", "Часто", "Почти всегда"],
            },
        ],
        "interpretation": {
            "max_score": 27,
            "ranges": [
                {"min": 0, "max": 0, "level": "non_problem", "message": "Непроблемный игрок"},
                {"min": 1, "max": 2, "level": "low_risk", "message": "Низкий риск"},
                {"min": 3, "max": 7, "level": "moderate_risk", "message": "Умеренный риск — есть признаки проблемного поведения"},
                {"min": 8, "max": 27, "level": "problem_gambling", "message": "Высокий риск — признаки проблемной игры. Рекомендуется обратиться за помощью."},
            ],
        },
    },

    # Еженедельный Risk Drift Test
    "C2": {
        "code": "C2",
        "level": "C",
        "name_ru": "Еженедельная оценка риска",
        "description_ru": "Проверка на «соскальзывание» в риск",
        "track": "all",
        "frequency": "weekly",
        "cooldown_days": 7,
        "questions": [
            {
                "code": "C2_Q1",
                "question_ru": "Было ли желание играть/делать ставки сильнее обычного на этой неделе?",
                "answer_type": "scale_0_3",
                "scale_labels": ["Нет", "Немного сильнее", "Заметно сильнее", "Намного сильнее"],
            },
            {
                "code": "C2_Q2",
                "question_ru": "Часто ли вы ловили себя на мыслях о ставках/игре?",
                "answer_type": "scale_0_3",
                "scale_labels": ["Нет", "Иногда", "Часто", "Постоянно"],
            },
            {
                "code": "C2_Q3",
                "question_ru": "Было ли ощущение, что «пора отыграться»?",
                "answer_type": "yes_no",
            },
            {
                "code": "C2_Q4",
                "question_ru": "Был ли импульс взять деньги в долг?",
                "answer_type": "yes_no",
            },
            {
                "code": "C2_Q5",
                "question_ru": "Изменилось ли настроение без видимой причины?",
                "answer_type": "scale_0_3",
                "scale_labels": ["Нет", "Немного", "Заметно", "Сильно"],
            },
        ],
        "interpretation": {
            "max_score": 15,  # учитывая yes_no как 0/3
            "ranges": [
                {"min": 0, "max": 3, "level": "green", "message": "Зелёная зона — стабильное состояние."},
                {"min": 4, "max": 6, "level": "yellow", "message": "Жёлтая зона — есть признаки напряжения. Будьте внимательны."},
                {"min": 7, "max": 15, "level": "red", "message": "Красная зона — повышенный риск. Рекомендуем использовать SOS-техники."},
            ],
        },
        "bot_actions": {
            "green": None,
            "yellow": "soft_intervention",  # Мягкие напоминания
            "red": "offer_sos",  # Предложить SOS и контакты
        },
    },

    # Emotional Balance Test (еженедельно)
    "C3": {
        "code": "C3",
        "level": "C",
        "name_ru": "Эмоциональный баланс недели",
        "description_ru": "Оценка эмоционального состояния за неделю",
        "track": "all",
        "frequency": "weekly",
        "cooldown_days": 7,
        "questions": [
            {
                "code": "C3_Q1",
                "question_ru": "Как часто на этой неделе вы чувствовали тревогу?",
                "answer_type": "scale_0_3",
                "scale_labels": ["Не чувствовал", "Редко", "Часто", "Постоянно"],
            },
            {
                "code": "C3_Q2",
                "question_ru": "Как часто вы чувствовали раздражение или злость?",
                "answer_type": "scale_0_3",
                "scale_labels": ["Не чувствовал", "Редко", "Часто", "Постоянно"],
            },
            {
                "code": "C3_Q3",
                "question_ru": "Были ли моменты радости и удовлетворения?",
                "answer_type": "scale_0_3",
                "scale_labels": ["Много", "Несколько", "Мало", "Не было"],
                "reverse_scoring": True,
            },
            {
                "code": "C3_Q4",
                "question_ru": "Чувствовали ли вы эмоциональное выгорание?",
                "answer_type": "scale_0_3",
                "scale_labels": ["Нет", "Немного", "Да", "Сильно"],
            },
        ],
    },

    # Financial Control Test (еженедельно для gambling/trading)
    "C4": {
        "code": "C4",
        "level": "C",
        "name_ru": "Финансовый контроль",
        "description_ru": "Оценка контроля над финансовым поведением",
        "track": "gambling,trading",
        "frequency": "weekly",
        "cooldown_days": 7,
        "questions": [
            {
                "code": "C4_Q1",
                "question_ru": "Придерживались ли вы финансовых лимитов на этой неделе?",
                "answer_type": "scale_0_3",
                "scale_labels": ["Полностью", "В основном", "Частично нарушал", "Не придерживался"],
                "reverse_scoring": True,
            },
            {
                "code": "C4_Q2",
                "question_ru": "Возникали ли мысли потратить больше запланированного?",
                "answer_type": "scale_0_3",
                "scale_labels": ["Нет", "Иногда", "Часто", "Постоянно"],
            },
            {
                "code": "C4_Q3",
                "question_ru": "Испытывали ли вы финансовый стресс?",
                "answer_type": "scale_0_3",
                "scale_labels": ["Нет", "Немного", "Да", "Сильный"],
            },
        ],
    },
}


# =========================================
# УРОВЕНЬ D — СОБЫТИЙНЫЕ ТЕСТЫ
# =========================================

LEVEL_D_TESTS = {
    # После срыва — Relapse Root Cause Test
    "D1": {
        "code": "D1",
        "level": "D",
        "name_ru": "Анализ срыва",
        "description_ru": "Помогает понять, что произошло, без осуждения",
        "track": "all",
        "frequency": "event",
        "trigger": "after_relapse",
        "intro_message": "Срыв — это информация, а не провал. Давайте разберёмся, что произошло.",
        "questions": [
            {
                "code": "D1_Q1",
                "question_ru": "Что стало триггером?",
                "answer_type": "choice",
                "allow_multiple": True,
                "choices": [
                    "Стресс",
                    "Скука",
                    "Конфликт",
                    "Финансовые мысли",
                    "Реклама / уведомление",
                    "Алкоголь",
                    "Спортивное событие",
                    "Одиночество",
                    "Усталость",
                    "Не знаю",
                ],
            },
            {
                "code": "D1_Q2",
                "question_ru": "В какой момент вы почувствовали импульс?",
                "answer_type": "choice",
                "choices": [
                    "Утром после пробуждения",
                    "В течение дня на работе/учёбе",
                    "Вечером дома",
                    "Ночью",
                    "После конкретного события",
                ],
            },
            {
                "code": "D1_Q3",
                "question_ru": "Что могло бы помочь остановиться?",
                "answer_type": "choice",
                "allow_multiple": True,
                "choices": [
                    "Пауза 10 минут",
                    "Звонок близкому",
                    "Техника дыхания",
                    "Убрать доступ к деньгам",
                    "Занять себя чем-то",
                    "Не знаю",
                ],
            },
            {
                "code": "D1_Q4",
                "question_ru": "Что вы чувствуете сейчас?",
                "answer_type": "choice",
                "allow_multiple": True,
                "choices": [
                    "Вину",
                    "Стыд",
                    "Разочарование",
                    "Злость на себя",
                    "Тревогу",
                    "Безразличие",
                    "Желание всё исправить",
                    "Надежду",
                ],
            },
            {
                "code": "D1_Q5",
                "question_ru": "Хотите ли вы поставить дополнительную защиту?",
                "answer_type": "choice",
                "choices": [
                    "Да, включить напоминания",
                    "Да, ограничить доступ к приложениям",
                    "Да, рассказать близкому",
                    "Пока нет",
                ],
            },
        ],
        "outro_message": "Спасибо за честность. Каждый срыв — это возможность узнать себя лучше и стать сильнее.",
    },

    # High Urge Decision Test
    "D2": {
        "code": "D2",
        "level": "D",
        "name_ru": "Тест при высокой тяге",
        "description_ru": "Когда тяга очень сильная (≥7)",
        "track": "all",
        "frequency": "event",
        "trigger": "high_urge",  # urge >= 7
        "intro_message": "Тяга сильная, но она пройдёт. Давайте разберёмся, что происходит.",
        "questions": [
            {
                "code": "D2_Q1",
                "question_ru": "Что сейчас происходит внутри?",
                "answer_type": "choice",
                "allow_multiple": True,
                "choices": [
                    "Напряжение в теле",
                    "Навязчивые мысли",
                    "Тревога",
                    "Возбуждение",
                    "Раздражение",
                    "Пустота",
                ],
            },
            {
                "code": "D2_Q2",
                "question_ru": "Есть ли ощущение «надо сделать прямо сейчас»?",
                "answer_type": "scale_0_3",
                "scale_labels": ["Нет", "Немного", "Да", "Очень сильно"],
            },
            {
                "code": "D2_Q3",
                "question_ru": "Готовы ли вы попробовать технику?",
                "answer_type": "choice",
                "choices": [
                    "Да, дыхание 4-4-4-4",
                    "Да, пауза 10 минут",
                    "Да, позвонить кому-то",
                    "Пока нет",
                ],
            },
        ],
        "outro_message": "Тяга — как волна. Она нарастает и спадает. Вы справитесь.",
        "offer_sos": True,
    },

    # Crisis Emotional Assessment
    "D3": {
        "code": "D3",
        "level": "D",
        "name_ru": "Оценка кризисного состояния",
        "description_ru": "При признаках кризиса",
        "track": "all",
        "frequency": "event",
        "trigger": "crisis_words",  # Если в заметке тревожные слова
        "intro_message": "Мы заметили, что вам может быть тяжело. Как вы себя чувствуете?",
        "questions": [
            {
                "code": "D3_Q1",
                "question_ru": "Как вы оцениваете своё состояние сейчас?",
                "answer_type": "scale_0_10",
                "scale_labels": ["Очень плохо", "", "", "", "", "", "", "", "", "", "Хорошо"],
            },
            {
                "code": "D3_Q2",
                "question_ru": "Чувствуете ли вы себя в безопасности?",
                "answer_type": "choice",
                "choices": [
                    "Да, я в безопасности",
                    "Не уверен(а)",
                    "Мне нужна помощь",
                ],
            },
            {
                "code": "D3_Q3",
                "question_ru": "Есть ли кто-то, кому вы можете позвонить?",
                "answer_type": "yes_no",
            },
        ],
        "crisis_response": {
            "safe": "Хорошо, что вы в безопасности. Мы рядом, если понадобимся.",
            "unsure": "Если вы не уверены в безопасности, пожалуйста, позвоните близкому или на горячую линию: 8-800-2000-122",
            "need_help": "Пожалуйста, позвоните сейчас: 112 (экстренная помощь) или 8-800-2000-122 (психологическая помощь). Вы не одиноки.",
        },
    },

    # Return Stability Test (после отсутствия 3+ дней)
    "D4": {
        "code": "D4",
        "level": "D",
        "name_ru": "Возвращение после паузы",
        "description_ru": "Когда пользователь отсутствовал 3+ дня",
        "track": "all",
        "frequency": "event",
        "trigger": "absence_3_days",
        "intro_message": "Рады вас видеть снова! Как прошли эти дни?",
        "questions": [
            {
                "code": "D4_Q1",
                "question_ru": "Как вы себя чувствовали в эти дни?",
                "answer_type": "scale_0_10",
                "scale_labels": ["Очень плохо", "", "", "", "", "", "", "", "", "", "Отлично"],
            },
            {
                "code": "D4_Q2",
                "question_ru": "Были ли срывы за это время?",
                "answer_type": "yes_no",
            },
            {
                "code": "D4_Q3",
                "question_ru": "Почему не заходили в приложение?",
                "answer_type": "choice",
                "choices": [
                    "Забыл(а)",
                    "Не было времени",
                    "Не было сил",
                    "Было хорошо и без него",
                    "Было плохо, не хотел(а) думать",
                    "Другое",
                ],
            },
        ],
        "outro_message": "Спасибо, что вернулись. Продолжаем вместе.",
    },
}


# Слова-триггеры для D3 (Crisis)
CRISIS_KEYWORDS = [
    "не хочу жить",
    "конец",
    "нет смысла",
    "лучше бы меня не было",
    "устал от всего",
    "всё плохо",
    "не вижу выхода",
    "сдаюсь",
    "безнадёжно",
]
